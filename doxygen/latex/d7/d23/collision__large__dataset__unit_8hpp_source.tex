\hypertarget{collision__large__dataset__unit_8hpp_source}{}\doxysection{collision\+\_\+large\+\_\+dataset\+\_\+unit.\+hpp}
\label{collision__large__dataset__unit_8hpp_source}\index{tesseract\_collision/core/include/tesseract\_collision/test\_suite/collision\_large\_dataset\_unit.hpp@{tesseract\_collision/core/include/tesseract\_collision/test\_suite/collision\_large\_dataset\_unit.hpp}}
\mbox{\hyperlink{collision__large__dataset__unit_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef TESSERACT\_COLLISION\_COLLISION\_LARGE\_DATASET\_UNIT\_HPP}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define TESSERACT\_COLLISION\_COLLISION\_LARGE\_DATASET\_UNIT\_HPP}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{5 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <chrono>}}
\DoxyCodeLine{8 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{convex__hull__utils_8h}{tesseract\_collision/bullet/convex\_hull\_utils.h}}>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{discrete__contact__manager_8h}{tesseract\_collision/core/discrete\_contact\_manager.h}}>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{common_8h}{tesseract\_collision/core/common.h}}>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{geometries_8h}{tesseract\_geometry/geometries.h}}>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__collision_1_1test__suite}{tesseract\_collision::test\_suite}}}
\DoxyCodeLine{16 \{}
\DoxyCodeLine{17 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespacetesseract__collision_1_1test__suite_a64721a2ef6abc909e9a762274303107b}{runTest}}(\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager}{DiscreteContactManager}}\& checker, \textcolor{keywordtype}{bool} use\_convex\_mesh = \textcolor{keyword}{false}, \textcolor{keywordtype}{int} num\_interations = 10)}
\DoxyCodeLine{18 \{}
\DoxyCodeLine{19   \textcolor{comment}{// Add Meshed Sphere to checker}}
\DoxyCodeLine{20   \mbox{\hyperlink{namespacetesseract__collision_a0aa5b9a264467e92cd1b9f0cd0c38ee8}{CollisionShapePtr}} sphere;}
\DoxyCodeLine{21 }
\DoxyCodeLine{22   \textcolor{keywordflow}{if} (use\_convex\_mesh)}
\DoxyCodeLine{23   \{}
\DoxyCodeLine{24     \mbox{\hyperlink{namespacetesseract__common_af89ed6517f4c84bdb2b037bb40f7d9d9}{tesseract\_common::VectorVector3d}} mesh\_vertices;}
\DoxyCodeLine{25     Eigen::VectorXi mesh\_faces;}
\DoxyCodeLine{26     EXPECT\_GT(}
\DoxyCodeLine{27         \mbox{\hyperlink{namespacetesseract__collision_ab79187502eefb0f670dbde89a5b7b969}{loadSimplePlyFile}}(std::string(TESSERACT\_SUPPORT\_DIR) + \textcolor{stringliteral}{"{}/meshes/sphere\_p25m.ply"{}}, mesh\_vertices, mesh\_faces),}
\DoxyCodeLine{28         0);}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     \textcolor{comment}{// This is required because convex hull cannot have multiple faces on the same plane.}}
\DoxyCodeLine{31     \textcolor{keyword}{auto} ch\_verticies = std::make\_shared<tesseract\_common::VectorVector3d>();}
\DoxyCodeLine{32     \textcolor{keyword}{auto} ch\_faces = std::make\_shared<Eigen::VectorXi>();}
\DoxyCodeLine{33     \textcolor{keywordtype}{int} ch\_num\_faces = \mbox{\hyperlink{namespacetesseract__collision_ac97bc1eb96f0aa2e1d3033d7e7758849}{createConvexHull}}(*ch\_verticies, *ch\_faces, mesh\_vertices);}
\DoxyCodeLine{34     sphere = std::make\_shared<tesseract\_geometry::ConvexMesh>(ch\_verticies, ch\_faces, ch\_num\_faces);}
\DoxyCodeLine{35   \}}
\DoxyCodeLine{36   \textcolor{keywordflow}{else}}
\DoxyCodeLine{37   \{}
\DoxyCodeLine{38     sphere = std::make\_shared<tesseract\_geometry::Sphere>(0.25);}
\DoxyCodeLine{39   \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{keywordtype}{double} delta = 0.55;}
\DoxyCodeLine{42 }
\DoxyCodeLine{43   std::size\_t t = 5;  \textcolor{comment}{// Because of unit test runtime this was reduced from 10 to 5.}}
\DoxyCodeLine{44   std::vector<std::string> link\_names;}
\DoxyCodeLine{45   \mbox{\hyperlink{namespacetesseract__common_a67bde3cb7bb235f0f61c370ef8bc74d8}{tesseract\_common::TransformMap}} location;}
\DoxyCodeLine{46   \textcolor{keywordflow}{for} (std::size\_t x = 0; x < t; ++x)}
\DoxyCodeLine{47   \{}
\DoxyCodeLine{48     \textcolor{keywordflow}{for} (std::size\_t y = 0; y < t; ++y)}
\DoxyCodeLine{49     \{}
\DoxyCodeLine{50       \textcolor{keywordflow}{for} (std::size\_t z = 0; z < t; ++z)}
\DoxyCodeLine{51       \{}
\DoxyCodeLine{52         \mbox{\hyperlink{namespacetesseract__collision_a2472107aae8174a30873bb0a955c3cb4}{CollisionShapesConst}} obj3\_shapes;}
\DoxyCodeLine{53         \mbox{\hyperlink{namespacetesseract__common_a94d9921fc7ed323609ac57d06f939cb6}{tesseract\_common::VectorIsometry3d}} obj3\_poses;}
\DoxyCodeLine{54         Eigen::Isometry3d sphere\_pose;}
\DoxyCodeLine{55         sphere\_pose.setIdentity();}
\DoxyCodeLine{56 }
\DoxyCodeLine{57         obj3\_shapes.push\_back(\mbox{\hyperlink{namespacetesseract__collision_a0aa5b9a264467e92cd1b9f0cd0c38ee8}{CollisionShapePtr}}(sphere-\/>clone()));}
\DoxyCodeLine{58         obj3\_poses.push\_back(sphere\_pose);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60         link\_names.push\_back(\textcolor{stringliteral}{"{}sphere\_link\_"{}} + std::to\_string(x) + std::to\_string(y) + std::to\_string(z));}
\DoxyCodeLine{61 }
\DoxyCodeLine{62         location[link\_names.back()] = sphere\_pose;}
\DoxyCodeLine{63         location[link\_names.back()].translation() = Eigen::Vector3d(}
\DoxyCodeLine{64             \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(x) * delta, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(y) * delta, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(z) * delta);}
\DoxyCodeLine{65         checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_a2a82db2881b5f7c701ed3d42db053ae8}{addCollisionObject}}(link\_names.back(), 0, obj3\_shapes, obj3\_poses);}
\DoxyCodeLine{66       \}}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68   \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70   \textcolor{comment}{// Check if they are in collision}}
\DoxyCodeLine{71   checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_a14111f72aeaa2f22cf79b64e54479fb0}{setActiveCollisionObjects}}(link\_names);}
\DoxyCodeLine{72   checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_acbd053442a4d591c29aab5be5706ef04}{setCollisionMarginData}}(\mbox{\hyperlink{namespacetesseract__collision_a0717a3c53d08d510257f631ea96cb560}{CollisionMarginData}}(0.1));}
\DoxyCodeLine{73   EXPECT\_NEAR(checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_abd2686026229a788a0e6836d20ea7008}{getCollisionMarginData}}().\mbox{\hyperlink{classtesseract__common_1_1CollisionMarginData_a8b73bd2450f2c9215e67bba3c048fe4b}{getMaxCollisionMargin}}(), 0.1, 1e-\/5);}
\DoxyCodeLine{74   checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_a21d038a9836cdb5a3b44ad527fd93a5b}{setCollisionObjectsTransform}}(location);}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \mbox{\hyperlink{namespacetesseract__collision_a96d77f62b7c26962d1090f0a2f00419b}{ContactResultVector}} result\_vector;}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{keyword}{auto} start\_time = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{79   num\_interations = 1;}
\DoxyCodeLine{80   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = 0; i < num\_interations; ++i)}
\DoxyCodeLine{81   \{}
\DoxyCodeLine{82     \mbox{\hyperlink{namespacetesseract__collision_a1eeace4cc41027dbde8e7dbeb77ca7cf}{ContactResultMap}} result;}
\DoxyCodeLine{83     result\_vector.clear();}
\DoxyCodeLine{84     checker.\mbox{\hyperlink{classtesseract__collision_1_1DiscreteContactManager_a1ddfa181400941e093c76a852df72425}{contactTest}}(result, \mbox{\hyperlink{structtesseract__collision_1_1ContactRequest}{ContactRequest}}(\mbox{\hyperlink{namespacetesseract__collision_ac3da4f46ae16e86ba4f1dfd2935eb80ca5fb1f955b45e38e31789286a1790398d}{ContactTestType::ALL}}));}
\DoxyCodeLine{85     \mbox{\hyperlink{namespacetesseract__collision_a3d63942ad37df10958b434c860782fbb}{flattenResults}}(std::move(result), result\_vector);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{keywordflow}{if} (result\_vector.size() != 300)}
\DoxyCodeLine{88       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& result : result\_vector)}
\DoxyCodeLine{89         std::cout << result.link\_names[0] << \textcolor{stringliteral}{"{},"{}} << result.link\_names[1] << \textcolor{stringliteral}{"{},"{}} << result.distance << std::endl;}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     EXPECT\_EQ(result\_vector.size(), 300);}
\DoxyCodeLine{92   \}}
\DoxyCodeLine{93   \textcolor{keyword}{auto} end\_time = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{94 }
\DoxyCodeLine{95   CONSOLE\_BRIDGE\_logInform(\textcolor{stringliteral}{"{}DT: \%f ms"{}}, std::chrono::duration<double, std::milli>(end\_time -\/ start\_time).count());}
\DoxyCodeLine{96 \}}
\DoxyCodeLine{97 \}  \textcolor{comment}{// namespace tesseract\_collision::test\_suite}}
\DoxyCodeLine{98 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_COLLISION\_COLLISION\_LARGE\_DATASET\_UNIT\_HPP}}

\end{DoxyCode}
