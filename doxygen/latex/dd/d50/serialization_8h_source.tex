\hypertarget{serialization_8h_source}{}\doxysection{serialization.\+h}
\label{serialization_8h_source}\index{tesseract\_common/include/tesseract\_common/serialization.h@{tesseract\_common/include/tesseract\_common/serialization.h}}
\mbox{\hyperlink{serialization_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef TESSERACT\_COMMON\_SERIALIZATION\_H}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define TESSERACT\_COMMON\_SERIALIZATION\_H}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{30 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <variant>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <boost/archive/xml\_oarchive.hpp>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <boost/archive/xml\_iarchive.hpp>}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <boost/archive/binary\_oarchive.hpp>}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#include <boost/archive/binary\_iarchive.hpp>}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <boost/serialization/tracking.hpp>}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include <boost/serialization/tracking\_enum.hpp>}}
\DoxyCodeLine{41 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{comment}{// Used to replace commas in these macros to avoid them being interpreted as multiple arguments}}
\DoxyCodeLine{44 \textcolor{comment}{// Example: TESSERACT\_SERIALIZE\_SAVE\_LOAD\_FREE\_ARCHIVES\_INSTANTIATE(std::variant<std::string COMMA Eigen::Isometry3d>)}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#define COMMA ,}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{comment}{// Use this macro for serialization defined using the invasive method inside the class}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#define TESSERACT\_SERIALIZE\_ARCHIVES\_INSTANTIATE(Type)                                                                 \(\backslash\)}}
\DoxyCodeLine{49 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::xml\_oarchive\& ar, const unsigned int version);                         \(\backslash\)}}
\DoxyCodeLine{50 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::xml\_iarchive\& ar, const unsigned int version);                         \(\backslash\)}}
\DoxyCodeLine{51 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::binary\_oarchive\& ar, const unsigned int version);                      \(\backslash\)}}
\DoxyCodeLine{52 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::binary\_iarchive\& ar, const unsigned int version);}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{comment}{// Use this macro for serialization defined using the invasive method inside the class with custom load/save functions}}
\DoxyCodeLine{55 \textcolor{preprocessor}{\#define TESSERACT\_SERIALIZE\_SAVE\_LOAD\_ARCHIVES\_INSTANTIATE(Type)                                                       \(\backslash\)}}
\DoxyCodeLine{56 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::xml\_oarchive\& ar, const unsigned int version);                         \(\backslash\)}}
\DoxyCodeLine{57 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::xml\_iarchive\& ar, const unsigned int version);                         \(\backslash\)}}
\DoxyCodeLine{58 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::binary\_oarchive\& ar, const unsigned int version);                      \(\backslash\)}}
\DoxyCodeLine{59 \textcolor{preprocessor}{  template void Type::serialize(boost::archive::binary\_iarchive\& ar, const unsigned int version);                      \(\backslash\)}}
\DoxyCodeLine{60 \textcolor{preprocessor}{  template void Type::save(boost::archive::xml\_oarchive\&, const unsigned int version) const;                           \(\backslash\)}}
\DoxyCodeLine{61 \textcolor{preprocessor}{  template void Type::load(boost::archive::xml\_iarchive\& ar, const unsigned int version);                              \(\backslash\)}}
\DoxyCodeLine{62 \textcolor{preprocessor}{  template void Type::save(boost::archive::binary\_oarchive\&, const unsigned int version) const;                        \(\backslash\)}}
\DoxyCodeLine{63 \textcolor{preprocessor}{  template void Type::load(boost::archive::binary\_iarchive\& ar, const unsigned int version);}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{comment}{// Use this macro for serialization defined using the non-\/invasive free function method outside the class}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#define TESSERACT\_SERIALIZE\_SAVE\_LOAD\_FREE\_ARCHIVES\_INSTANTIATE(Type)                                                  \(\backslash\)}}
\DoxyCodeLine{67 \textcolor{preprocessor}{  template void boost::serialization::serialize(                                                                       \(\backslash\)}}
\DoxyCodeLine{68 \textcolor{preprocessor}{      boost::archive::xml\_oarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                             \(\backslash\)}}
\DoxyCodeLine{69 \textcolor{preprocessor}{  template void boost::serialization::serialize(                                                                       \(\backslash\)}}
\DoxyCodeLine{70 \textcolor{preprocessor}{      boost::archive::xml\_iarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                             \(\backslash\)}}
\DoxyCodeLine{71 \textcolor{preprocessor}{  template void boost::serialization::serialize(                                                                       \(\backslash\)}}
\DoxyCodeLine{72 \textcolor{preprocessor}{      boost::archive::binary\_oarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                          \(\backslash\)}}
\DoxyCodeLine{73 \textcolor{preprocessor}{  template void boost::serialization::serialize(                                                                       \(\backslash\)}}
\DoxyCodeLine{74 \textcolor{preprocessor}{      boost::archive::binary\_iarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                          \(\backslash\)}}
\DoxyCodeLine{75 \textcolor{preprocessor}{  template void boost::serialization::save(                                                                            \(\backslash\)}}
\DoxyCodeLine{76 \textcolor{preprocessor}{      boost::archive::xml\_oarchive\&, const Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                          \(\backslash\)}}
\DoxyCodeLine{77 \textcolor{preprocessor}{  template void boost::serialization::load(                                                                            \(\backslash\)}}
\DoxyCodeLine{78 \textcolor{preprocessor}{      boost::archive::xml\_iarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                             \(\backslash\)}}
\DoxyCodeLine{79 \textcolor{preprocessor}{  template void boost::serialization::save(                                                                            \(\backslash\)}}
\DoxyCodeLine{80 \textcolor{preprocessor}{      boost::archive::binary\_oarchive\&, const Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{                       \(\backslash\)}}
\DoxyCodeLine{81 \textcolor{preprocessor}{  template void boost::serialization::load(                                                                            \(\backslash\)}}
\DoxyCodeLine{82 \textcolor{preprocessor}{      boost::archive::binary\_iarchive\& ar, Type\& g, const unsigned int version); }\textcolor{comment}{/* NOLINT */}\textcolor{preprocessor}{}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__common}{tesseract\_common}}}
\DoxyCodeLine{85 \{}
\DoxyCodeLine{86 \textcolor{keyword}{struct }\mbox{\hyperlink{structtesseract__common_1_1Serialization}{Serialization}}}
\DoxyCodeLine{87 \{}
\DoxyCodeLine{88   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{89   \textcolor{keyword}{static} std::string \mbox{\hyperlink{structtesseract__common_1_1Serialization_aa67e1886738f13074407c2ddb558c610}{toArchiveStringXML}}(\textcolor{keyword}{const} SerializableType\& archive\_type, \textcolor{keyword}{const} std::string\& name = \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{90   \{}
\DoxyCodeLine{91     std::stringstream ss;}
\DoxyCodeLine{92     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{93       boost::archive::xml\_oarchive oa(ss);}
\DoxyCodeLine{94 }
\DoxyCodeLine{95       \textcolor{comment}{// Boost uses the same function for serialization and deserialization so it requires a non-\/const reference}}
\DoxyCodeLine{96       \textcolor{comment}{// Because we are only serializing here it is safe to cast away const}}
\DoxyCodeLine{97       \textcolor{keywordflow}{if} (name.empty())}
\DoxyCodeLine{98         oa << boost::serialization::make\_nvp<SerializableType>(\textcolor{stringliteral}{"{}archive\_type"{}},}
\DoxyCodeLine{99                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{100       \textcolor{keywordflow}{else}}
\DoxyCodeLine{101         oa << boost::serialization::make\_nvp<SerializableType>(name.c\_str(),}
\DoxyCodeLine{102                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{103     \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{105     \textcolor{keywordflow}{return} ss.str();}
\DoxyCodeLine{106   \}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{109   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{structtesseract__common_1_1Serialization_a07a0927a3734ee3cb3ce76bc6a0ac1be}{toArchiveFileXML}}(\textcolor{keyword}{const} SerializableType\& archive\_type,}
\DoxyCodeLine{110                                \textcolor{keyword}{const} std::string\& file\_path,}
\DoxyCodeLine{111                                \textcolor{keyword}{const} std::string\& name = \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{112   \{}
\DoxyCodeLine{113     std::ofstream os(file\_path);}
\DoxyCodeLine{114     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{115       boost::archive::xml\_oarchive oa(os);}
\DoxyCodeLine{116       \textcolor{comment}{// Boost uses the same function for serialization and deserialization so it requires a non-\/const reference}}
\DoxyCodeLine{117       \textcolor{comment}{// Because we are only serializing here it is safe to cast away const}}
\DoxyCodeLine{118       \textcolor{keywordflow}{if} (name.empty())}
\DoxyCodeLine{119         oa << boost::serialization::make\_nvp<SerializableType>(\textcolor{stringliteral}{"{}archive\_type"{}},}
\DoxyCodeLine{120                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{121       \textcolor{keywordflow}{else}}
\DoxyCodeLine{122         oa << boost::serialization::make\_nvp<SerializableType>(name.c\_str(),}
\DoxyCodeLine{123                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{124     \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{127   \}}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{130   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{structtesseract__common_1_1Serialization_af37efc32e11c2e18238a176d3b101afb}{toArchiveFileBinary}}(\textcolor{keyword}{const} SerializableType\& archive\_type,}
\DoxyCodeLine{131                                   \textcolor{keyword}{const} std::string\& file\_path,}
\DoxyCodeLine{132                                   \textcolor{keyword}{const} std::string\& name = \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{133   \{}
\DoxyCodeLine{134     std::ofstream os(file\_path, std::ios\_base::binary);}
\DoxyCodeLine{135     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{136       boost::archive::binary\_oarchive oa(os);}
\DoxyCodeLine{137       \textcolor{comment}{// Boost uses the same function for serialization and deserialization so it requires a non-\/const reference}}
\DoxyCodeLine{138       \textcolor{comment}{// Because we are only serializing here it is safe to cast away const}}
\DoxyCodeLine{139       \textcolor{keywordflow}{if} (name.empty())}
\DoxyCodeLine{140         oa << boost::serialization::make\_nvp<SerializableType>(\textcolor{stringliteral}{"{}archive\_type"{}},}
\DoxyCodeLine{141                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{142       \textcolor{keywordflow}{else}}
\DoxyCodeLine{143         oa << boost::serialization::make\_nvp<SerializableType>(name.c\_str(),}
\DoxyCodeLine{144                                                                \textcolor{keyword}{const\_cast<}SerializableType\&\textcolor{keyword}{>}(archive\_type));  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{145     \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{147     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{148   \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{151   \textcolor{keyword}{static} SerializableType \mbox{\hyperlink{structtesseract__common_1_1Serialization_a643e19fe172d0dbd2b8a5d8c623dabe9}{fromArchiveStringXML}}(\textcolor{keyword}{const} std::string\& archive\_xml)}
\DoxyCodeLine{152   \{}
\DoxyCodeLine{153     SerializableType archive\_type;}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{156       std::stringstream ss(archive\_xml);}
\DoxyCodeLine{157       boost::archive::xml\_iarchive ia(ss);}
\DoxyCodeLine{158       ia >> BOOST\_SERIALIZATION\_NVP(archive\_type);}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{keywordflow}{return} archive\_type;}
\DoxyCodeLine{162   \}}
\DoxyCodeLine{163 }
\DoxyCodeLine{164   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{165   \textcolor{keyword}{static} SerializableType \mbox{\hyperlink{structtesseract__common_1_1Serialization_aaec903390b21dab3a5d823e58aef7178}{fromArchiveFileXML}}(\textcolor{keyword}{const} std::string\& file\_path)}
\DoxyCodeLine{166   \{}
\DoxyCodeLine{167     SerializableType archive\_type;}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{170       std::ifstream ifs(file\_path);}
\DoxyCodeLine{171       assert(ifs.good());}
\DoxyCodeLine{172       boost::archive::xml\_iarchive ia(ifs);}
\DoxyCodeLine{173       ia >> BOOST\_SERIALIZATION\_NVP(archive\_type);}
\DoxyCodeLine{174     \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     \textcolor{keywordflow}{return} archive\_type;}
\DoxyCodeLine{177   \}}
\DoxyCodeLine{178 }
\DoxyCodeLine{179   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SerializableType>}
\DoxyCodeLine{180   \textcolor{keyword}{static} SerializableType \mbox{\hyperlink{structtesseract__common_1_1Serialization_a26736551741fd8b511dacbab955da159}{fromArchiveFileBinary}}(\textcolor{keyword}{const} std::string\& file\_path)}
\DoxyCodeLine{181   \{}
\DoxyCodeLine{182     SerializableType archive\_type;}
\DoxyCodeLine{183 }
\DoxyCodeLine{184     \{  \textcolor{comment}{// Must be scoped because all data is not written until the oost::archive::xml\_oarchive goes out of scope}}
\DoxyCodeLine{185       std::ifstream ifs(file\_path, std::ios\_base::binary);}
\DoxyCodeLine{186       assert(ifs.good());}
\DoxyCodeLine{187       boost::archive::binary\_iarchive ia(ifs);}
\DoxyCodeLine{188       ia >> BOOST\_SERIALIZATION\_NVP(archive\_type);}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191     \textcolor{keywordflow}{return} archive\_type;}
\DoxyCodeLine{192   \}}
\DoxyCodeLine{193 \};}
\DoxyCodeLine{194 \}  \textcolor{comment}{// namespace tesseract\_common}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_COMMON\_SERIALIZATION\_H}}

\end{DoxyCode}
